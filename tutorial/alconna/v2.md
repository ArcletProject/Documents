# Alconna

::: warning

è¯¥æ•™ç¨‹æ˜¯å¯¹æ•´ä¸ª Alconna ç‰¹æ€§çš„å¤§è‡´å½’çº³ï¼Œä»¥å¸®åŠ©è¯»è€…ç†Ÿæ‚‰ Alconna çš„ä½¿ç”¨ä¸å¼€å‘ã€‚

æœ‰å…³æ›´å¤šè¯¦ç»†å†…å®¹ï¼Œè¯·å‚é˜… [æ–‡æ¡£](/guide/alconna)

:::

::: danger

è¯¥éƒ¨åˆ†å†…å®¹å¯¹åº”çš„ v2 ç‰ˆæœ¬çš„ Alconna ä»ç„¶å¤„äºå¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šæœ‰è¾ƒå¤§å˜åŠ¨ã€‚

:::


[`Alconna`](https://github.com/ArcletProject/Alconna) éš¶å±äº `ArcletProject`ï¼Œæ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ã€é«˜æ•ˆçš„å‘½ä»¤å‚æ•°è§£æå™¨, å¹¶ä¸”ä¸å±€é™äºè§£æå‘½ä»¤å¼å­—ç¬¦ä¸²ã€‚

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ **Alconna** çš„æ ¸å¿ƒ â€”â€” `Args`, `Subcommand`, `Option`ï¼š

```python
from arclet.alconna import Alconna, Args, Subcommand, Option

alc = Alconna(
    "pip",
    Subcommand(
        "install",
        Args.package(str),
        Option("-r|--requirement", Args.file(str)),
        Option("-i|--index-url", Args.url(str)),
    )
)

res = alc.parse("pip install arclet-entari -i URL")

print(res)
# matched=True, header_match=(origin='pip' result='pip' matched=True), value_result={('install',): Ellipsis, ('install', 'index-url'): Ellipsis}, other_args={'package': 'arclet-entari', 'url': 'URL'}

print(res.all_matched_args)
# {'package': 'arclet-entari', 'url': 'URL'}
```

:::details è§£é‡Š
è¿™æ®µä»£ç é€šè¿‡ `Alconna ` åˆ›å»ºäº†ä¸€ä¸ªæ¥å—ä¸»å‘½ä»¤åä¸º `pip`, å­å‘½ä»¤ä¸º `install` ä¸”å­å‘½ä»¤æ¥å—ä¸€ä¸ª **Args** å‚æ•°packageå’ŒäºŒä¸ª **Option** å‚æ•°`requirement`å’Œ`index-url`çš„å‘½ä»¤å‚æ•°è§£æå™¨, é€šè¿‡parseæ–¹æ³•è¿”å›è§£æç»“æœ **Arparma** çš„å®ä¾‹ã€‚
:::

å…¶ç‰¹ç‚¹æœ‰:

* é«˜æ•ˆ. åœ¨ i5-10210U å¤„ç†å™¨ä¸Š, æ€§èƒ½å¤§çº¦ä¸º `+71000~289000 msg/s`
* ç›´è§‚çš„å‘½ä»¤ç»„ä»¶åˆ›å»ºæ–¹å¼
* å¼ºå¤§çš„ç±»å‹è§£æä¸ç±»å‹è½¬æ¢åŠŸèƒ½
* è‡ªå®šä¹‰çš„å¸®åŠ©ä¿¡æ¯æ ¼å¼ä¸å‘½ä»¤è§£ææ§åˆ¶
* i18n
* å‘½ä»¤è¾“å…¥ç¼“å­˜, ä»¥ä¿è¯é‡å¤å‘½ä»¤çš„å¿«é€Ÿå“åº”
* æ˜“ç”¨çš„å¿«æ·å‘½ä»¤åˆ›å»ºä¸ä½¿ç”¨
* å¯ä»¥ç»‘å®šå›è°ƒå‡½æ•°, ä»¥ä¾¿äºåœ¨å‘½ä»¤è§£æå®Œæˆåæ‰§è¡Œ
* å¯åˆ›å»ºå‘½ä»¤è¡¥å…¨ä¼šè¯, ä»¥å®ç°å¤šè½®è¿ç»­çš„è¡¥å…¨æç¤º
* æ¨¡ç³ŠåŒ¹é…ã€è¾“å‡ºæ•è·ç­‰ä¸€ä¼—ç‰¹æ€§


## å®‰è£…

```bash
git clone https://github.com/ArcletProject/Alconna@dev
```

[//]: # (::: code-group)

[//]: # ()
[//]: # (```bash [pdm])

[//]: # (pdm add arclet-alconna)

[//]: # (```)

[//]: # ()
[//]: # ()
[//]: # (```bash [poetry])

[//]: # (poetry add arclet-alconna)

[//]: # (```)

[//]: # ()
[//]: # (```bash [pip])

[//]: # (pip install --upgrade arclet-alconna)

[//]: # (```)

[//]: # ()
[//]: # (:::)

## å‚æ•°å£°æ˜(Args)

**Args** æ˜¯ç”¨äºå£°æ˜å‘½ä»¤å‚æ•°çš„ç»„ä»¶, åœ¨ Alconna ä¸­æœ‰éå¸¸é‡è¦çš„åœ°ä½ï¼Œç”šè‡³ç§°å¾—ä¸Šæ˜¯æ ¸å¿ƒï¼Œæ¯” Alconna é‡è¦åå€ç”šè‡³ä¹å€ã€‚

**Args** å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ„é€ ï¼š

:::code-group

```python [åŠ¨æ€å½¢å¼]
from arclet.alconna import Alconna, Args

alc = Alconna("test", Args.foo(str).bar(int))
# Args.key(var).key1(var1, default=default1, ...)
```

```python [é™æ€å½¢å¼]
from arclet.alconna import Alconna, ArgsBase, arg_field

class TestArgs(ArgsBase):
    foo: str
    bar: int
#   key: var
#   key1: var1 = default1
#   key2: var2 = arg_field(default=default2)

alc = Alconna("test", TestArgs)
```

```python [Argåˆ—è¡¨å½¢å¼]
from arclet.alconna import Alconna, Arg

alc = Alconna("test", Arg("foo", str), Arg("bar", int))
# Arg(key, var), Arg(key, var, default=default, ...)
```
:::

å…¶ä¸­ï¼Œkey **ä¸€å®š**æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œ var ä¸€èˆ¬ä¸ºå‚æ•°çš„ç±»å‹ï¼Œdefault ä¸ºå¯èƒ½çš„é»˜è®¤å€¼ã€‚

å…¶ä¸å‡½æ•°ç­¾åç±»ä¼¼ï¼Œä½†æ˜¯**åŠ¨æ€æ„å»ºä¸­**å…è®¸å«æœ‰é»˜è®¤å€¼çš„å‚æ•°åœ¨å‰ã€‚

### å‚æ•°å(key)

`key` çš„ä½œç”¨æ˜¯ç”¨ä»¥æ ‡è®°è§£æå‡ºæ¥çš„å‚æ•°å¹¶å­˜æ”¾äº **Arparma** ä¸­ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·è°ƒç”¨ã€‚

:::info

`Args` ä¸­çš„ `key` åœ¨å®é™…å‘½ä»¤ä¸­å¹¶ä¸éœ€è¦ä¼ å…¥ï¼ˆkeyword å‚æ•°é™¤å¤–ï¼‰ï¼š

```python
from arclet.alconna import Alconna, Args

alc = Alconna("test", Args.foo(str))
alc.parse("test --foo abc") # é”™è¯¯
alc.parse("test abc") # æ­£ç¡®
```

è‹¥éœ€è¦ `test --foo abc`ï¼Œä½ åº”è¯¥ä½¿ç”¨ `Option`ï¼š

```python
from arclet.alconna import Alconna, Args, Option

alc = Alconna("test", Option("--foo", Args.foo(str)))
```

:::

### å‚æ•°å€¼(var)

var è´Ÿè´£å‘½ä»¤å‚æ•°çš„**ç±»å‹æ£€æŸ¥ä¸ç±»å‹è½¬åŒ–**

`Args` çš„`var`è¡¨é¢ä¸Šçœ‹éœ€è¦ä¼ å…¥ä¸€ä¸ª `type`ï¼Œä½†å®é™…ä¸Šå®ƒéœ€è¦çš„æ˜¯ä¸€ä¸ª `nepattern.Pattern` çš„å®ä¾‹ï¼š

```python
from arclet.alconna import Args
from nepattern import Pattern

# è¡¨ç¤º foo å‚æ•°éœ€è¦åŒ¹é…ä¸€ä¸ª @number æ ·å¼çš„å­—ç¬¦ä¸²
args = Args.foo(Pattern.regex_match("@\d+"))
```

`pip` ç¤ºä¾‹ä¸­å¯ä»¥ä¼ å…¥ `str` æ˜¯å› ä¸º `str` å·²ç»æ³¨å†Œåœ¨äº† `nepattern.global_patterns` ä¸­ï¼Œå› æ­¤ä¼šæ›¿æ¢ä¸º `nepattern.global_patterns[str]`

`nepattern.global_patterns`é»˜è®¤æ”¯æŒçš„ç±»å‹æœ‰ï¼š

- `str`: åŒ¹é…ä»»æ„å­—ç¬¦ä¸²
- `int`: åŒ¹é…æ•´æ•°
- `float`: åŒ¹é…æµ®ç‚¹æ•°
- `bool`: åŒ¹é… `True` ä¸ `False` ä»¥åŠä»–ä»¬å°å†™å½¢å¼
- `hex`: åŒ¹é… `0x` å¼€å¤´çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²
- `url`: åŒ¹é…ç½‘å€
- `email`: åŒ¹é… `xxxx@xxx` çš„å­—ç¬¦ä¸²
- `ipv4`: åŒ¹é… `xxx.xxx.xxx.xxx` çš„å­—ç¬¦ä¸²
- `list`: åŒ¹é…ç±»ä¼¼ `["foo","bar","baz"]` çš„å­—ç¬¦ä¸²
- `dict`: åŒ¹é…ç±»ä¼¼ `{"foo":"bar","baz":"qux"}` çš„å­—ç¬¦ä¸²
- `datetime`: ä¼ å…¥ä¸€ä¸ª `datetime` æ”¯æŒçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œæˆ–æ—¶é—´æˆ³
- `Any`: åŒ¹é…ä»»æ„ç±»å‹
- `AnyString`: åŒ¹é…ä»»æ„ç±»å‹ï¼Œè½¬ä¸º `str`
- `Number`: åŒ¹é… `int` ä¸ `float`ï¼Œè½¬ä¸º `int`

åŒæ—¶å¯ä»¥ä½¿ç”¨ typing ä¸­çš„ç±»å‹ï¼š

- `Literal[X]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼
- `Union[X, Y]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªç±»å‹
- `Optional[xxx]`: ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼è®¾ä¸º `None`ï¼Œå¹¶åœ¨è§£æå¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼
- `list[X]`: åŒ¹é…ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­çš„å…ƒç´ ä¸º `X` ç±»å‹
- `dict[X, Y]`: åŒ¹é…ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­çš„ key ä¸º `X` ç±»å‹ï¼Œvalue ä¸º `Y` ç±»å‹
- ...

:::tip

å‡ ç±»ç‰¹æ®Šçš„ä¼ å…¥æ ‡è®°ï¼š

- `"foo"`: åŒ¹é…å­—ç¬¦ä¸² "foo" (è‹¥æ²¡æœ‰æŸä¸ª `BasePattern` ä¸ä¹‹å…³è”)
- `RawStr("foo")`: åŒ¹é…å­—ç¬¦ä¸² "foo" (å³ä½¿æœ‰ `BasePattern` ä¸ä¹‹å…³è”ä¹Ÿä¸ä¼šè¢«æ›¿æ¢)
- `"foo|bar|baz"`: åŒ¹é… "foo" æˆ– "bar" æˆ– "baz"
- `[foo, bar, Baz, ...]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼æˆ–ç±»å‹
- `Callable[[X], Y]`: åŒ¹é…ä¸€ä¸ªå‚æ•°ä¸º `X` ç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›é€šè¿‡è¯¥å‡½æ•°è°ƒç”¨å¾—åˆ°çš„ `Y` ç±»å‹çš„å€¼
- `"re:xxx"`: åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ `xxx`ï¼Œä¼šè¿”å› Match[0]
- `"rep:xxx"`: åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ `xxx`ï¼Œä¼šè¿”å› `re.Match` å¯¹è±¡
- `{foo: bar, baz: qux}`: åŒ¹é…å­—å…¸ä¸­çš„ä»»æ„ä¸€ä¸ªé”®, å¹¶è¿”å›å¯¹åº”çš„å€¼ (ç‰¹æ®Šçš„é”® ... ä¼šåŒ¹é…ä»»æ„çš„å€¼)
- ...

**ç‰¹åˆ«çš„**ï¼Œä½ å¯ä»¥ä¸ä¼ å…¥ `var`ï¼Œæ­¤æ—¶ä¼šä½¿ç”¨ `key` ä½œä¸º `var`, åŒ¹é… `key` å­—ç¬¦ä¸²ã€‚

:::

### å‚æ•°åŸŸ(Field)

é™¤äº† `key` ä¸ `var` å¤–ï¼Œå‰©ä½™çš„å‚æ•°éƒ½ä¼šè¢«è§†ä¸º **Field** å¯¹è±¡çš„å±æ€§ã€‚å…¶ç”¨äºæºå¸¦å¯¹äºè¯¥å‚æ•°çš„æ›´å¤šä¿¡æ¯ã€‚

**Field** å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š
- default: `T` é»˜è®¤å€¼
- default_factory: `() -> T` é»˜è®¤å€¼å·¥å‚
- alias: `str | None` ç»™é»˜è®¤å€¼çš„åˆ«å
- completion: `(() -> str | list[str]) | None` è¡¥å…¨æç¤º
- unmatch_tips: `(Any) -> str | None` ä¼ å…¥å‚æ•°æœªåŒ¹é…æ—¶çš„æç¤ºä¿¡æ¯
- missing_tips: `() -> str | None` ç¼ºå¤±ä¼ å…¥å‚æ•°æ—¶çš„æç¤ºä¿¡æ¯
- notice: `str` æ³¨é‡Š/å¸®åŠ©ä¿¡æ¯
- seps: `str` å‚æ•°å•å…ƒä½¿ç”¨çš„åˆ†éš”ç¬¦
- multiple: `bool | int | "+" | "*" | "str"` å‚æ•°å•å…ƒæ˜¯å¦å¯æ¥å—å¤šä¸ªå€¼ï¼Œç±»ä¼¼äºå‡½æ•°ä¸­çš„ `*args`
- optional: `bool` å‚æ•°å•å…ƒæ˜¯å¦å¯é€‰
- hidden: `bool` å‚æ•°å•å…ƒæ˜¯å¦éšè—ç±»å‹ï¼ˆåœ¨å¸®åŠ©ä¿¡æ¯ä¸­åªæ˜¾ç¤ºåç§°ï¼‰
- wildcard: `bool` å‚æ•°å•å…ƒæ˜¯å¦ä¸ºæ³›åŒ¹é… (å³è¯¥å‚æ•°åçš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«åŒ¹é…åˆ°è¯¥å‚æ•°ä¸­ï¼Œå¹¶ç»“æŸè§£æ)

é»˜è®¤æƒ…å†µä¸‹ (å³ä¸å£°æ˜) `default` çš„å€¼ä¸ºç‰¹æ®Šå€¼ `Empty`ã€‚è¿™ä¹Ÿæ„å‘³ç€ä½ å¯ä»¥å°†é»˜è®¤å€¼è®¾ç½®ä¸º `None` è¡¨ç¤ºé»˜è®¤å€¼ä¸ºç©ºå€¼ã€‚

:::info
`multiple` çš„å€¼å¯ä»¥ä¸º `bool`ï¼Œ`int`ï¼Œ`"+"`ï¼Œ`"*"`ï¼Œ`"str"`:
- `bool`: è¡¨ç¤ºæ˜¯å¦æ¥å—å¤šä¸ªå€¼
- `int`: è¡¨ç¤ºæ¥å—çš„å€¼çš„æœ€å¤§æ•°é‡
- `"+"`: è¡¨ç¤ºæ¥å—å¤šä¸ªå€¼ï¼Œä½†è‡³å°‘æ¥å—ä¸€ä¸ª
- `"*"`: è¡¨ç¤ºæ¥å—å¤šä¸ªå€¼ï¼Œä½†å¯ä»¥æ¥å—é›¶ä¸ª
- `"str"`: è¡¨ç¤ºæ¥å—å¤šä¸ªå€¼ï¼Œä½†ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²
:::

## é€‰é¡¹ä¸å­å‘½ä»¤(Option & Subcommand)

**Option** ä¸ **Subcommand** æ˜¯ Alconna ä¸­çš„ä¸¤ä¸ªé‡è¦ç»„ä»¶ã€‚

`Option` å’Œ `Subcommand` å¯ä»¥ä¼ å…¥ä¸€ç»„ `alias`ï¼Œ

å¦‚ `Option("--foo|-F|--FOO|-f")`ï¼Œ`Subcommand("foo", alias=["F"])`

ä¼ å…¥åˆ«ååï¼Œé€‰é¡¹ä¸å­å‘½ä»¤ä¼šé€‰æ‹©å…¶ä¸­é•¿åº¦æœ€é•¿çš„ä½œä¸ºå…¶åç§°ã€‚è‹¥ä¼ å…¥ä¸º "--foo|-f"ï¼Œåˆ™å‘½ä»¤åç§°ä¸º "--foo"

:::tip ç‰¹åˆ«æé†’!!!

Option çš„åå­—æˆ–åˆ«å**æ²¡æœ‰è¦æ±‚**å¿…é¡»åœ¨å‰é¢å†™ä¸Š `-`

Option ä¸ Subcommand çš„å”¯ä¸€åŒºåˆ«åœ¨äº Subcommand å¯ä»¥ä¼ å…¥è‡ªå·±çš„ **Option** ä¸ **Subcommand**

:::


ä»–ä»¬æ‹¥æœ‰å¦‚ä¸‹å…±åŒå‚æ•°ï¼š

- `help_text`: ä¼ å…¥è¯¥ç»„ä»¶çš„å¸®åŠ©ä¿¡æ¯

- `dest`: è¢«æŒ‡å®šä¸ºè§£æå®Œæˆæ—¶æ ‡æ³¨åŒ¹é…ç»“æœçš„æ ‡è¯†ç¬¦ï¼Œä¸ä¼ å…¥æ—¶é»˜è®¤ä¸ºé€‰é¡¹æˆ–å­å‘½ä»¤çš„åç§° (name)

- `default`: é»˜è®¤å€¼ï¼Œåœ¨è¯¥ç»„ä»¶æœªè¢«è§£ææ—¶ä½¿ç”¨ä½¿ç”¨è¯¥å€¼æ›¿æ¢ã€‚

  ç‰¹åˆ«çš„ï¼Œä½¿ç”¨ `OptionResult` æˆ– `SubcomanndResult` å¯ä»¥è®¾ç½®åŒ…æ‹¬å‚æ•°å­—å…¸åœ¨å†…çš„é»˜è®¤å€¼ï¼š

  ```python
  from arclet.alconna import Option, OptionResult

  opt1 = Option("--foo", default=False)
  opt2 = Option("--foo", default=OptionResult(value=False, args={"bar": 1}))
  ```

### é€‰é¡¹æ“ä½œ(Action)

`Option` å¯ä»¥ç‰¹åˆ«è®¾ç½®ä¼ å…¥ä¸€ç±» `Action`ï¼Œä½œä¸ºè§£ææ“ä½œ

`Action` åˆ†ä¸ºä¸‰ç±»ï¼š
- `store`: æ—  Args æ—¶ï¼Œ ä»…å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œ é»˜è®¤ä¸º Ellipsisï¼› æœ‰ Args æ—¶ï¼Œ åç»­çš„è§£æç»“æœä¼šè¦†ç›–ä¹‹å‰çš„å€¼
- `append`: æ—  Args æ—¶ï¼Œ å°†å¤šä¸ªå€¼å­˜ä¸ºåˆ—è¡¨ï¼Œ é»˜è®¤ä¸º Ellipsisï¼› æœ‰ Args æ—¶ï¼Œ æ¯ä¸ªè§£æç»“æœä¼šè¿½åŠ åˆ°åˆ—è¡¨ä¸­

  å½“å­˜åœ¨é»˜è®¤å€¼å¹¶ä¸”ä¸ä¸ºåˆ—è¡¨æ—¶ï¼Œ ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼å˜æˆåˆ—è¡¨ï¼Œ ä»¥ä¿è¯è¿½åŠ çš„æ­£ç¡®æ€§
- `count`: æ—  Args æ—¶ï¼Œ è®¡æ•°å™¨åŠ ä¸€ï¼› æœ‰ Args æ—¶ï¼Œ è¡¨ç°ä¸ STORE ç›¸åŒ

  å½“å­˜åœ¨é»˜è®¤å€¼å¹¶ä¸”ä¸ä¸ºæ•°å­—æ—¶ï¼Œ ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼å˜æˆ 1ï¼Œ ä»¥ä¿è¯è®¡æ•°å™¨çš„æ­£ç¡®æ€§ã€‚

`Alconna` æä¾›äº†é¢„åˆ¶çš„å‡ ç±» `action`ï¼š
- `store`ï¼Œ`store_value`ï¼Œ`store_true`ï¼Œ`store_false`
- `append`ï¼Œ`append_value`
- `count`

## è§£æç»“æœ(Arparma)

`Alconna.parse` ä¼šè¿”å›ç”± **Arparma** æ‰¿è½½çš„è§£æç»“æœã€‚

`Arpamar` ä¼šæœ‰å¦‚ä¸‹å‚æ•°ï¼š

- è°ƒè¯•ç±»
  - matched: æ˜¯å¦åŒ¹é…æˆåŠŸ
  - error_data: è§£æå¤±è´¥æ—¶å‰©ä½™çš„æ•°æ®
  - error_info: è§£æå¤±è´¥æ—¶çš„å¼‚å¸¸å†…å®¹
  - origin: åŸå§‹å‘½ä»¤ï¼Œå¯ä»¥ç±»å‹æ ‡æ³¨

- åˆ†æç±»
  - header_match: å‘½ä»¤å¤´éƒ¨çš„è§£æç»“æœï¼ŒåŒ…æ‹¬åŸå§‹å¤´éƒ¨ã€è§£æåå¤´éƒ¨ã€è§£æç»“æœä¸å¯èƒ½çš„æ­£åˆ™åŒ¹é…ç»„
  - main_args: å‘½ä»¤çš„ä¸»å‚æ•°çš„è§£æç»“æœ
  - options: å‘½ä»¤æ‰€æœ‰é€‰é¡¹çš„è§£æç»“æœ

  - subcommands: å‘½ä»¤æ‰€æœ‰å­å‘½ä»¤çš„è§£æç»“æœ
  - other_args: é™¤ä¸»å‚æ•°å¤–çš„å…¶ä»–è§£æç»“æœ
  - all_matched_args: æ‰€æœ‰ Args çš„è§£æç»“æœ

`Arparma` åŒæ—¶æä¾›äº†ä¾¿æ·çš„æŸ¥è¯¢æ–¹æ³• `query[T]()`ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„ `path` æŸ¥æ‰¾å‚æ•°å¹¶è¿”å›

`path` æ”¯æŒå¦‚ä¸‹ï¼š
- `options`, ...: è¿”å›å¯¹åº”çš„å±æ€§
- `args`: è¿”å› all_matched_args
- `options.xxx`, ...: è¿”å›å­—å…¸ä¸­ `xxx`é”®å¯¹åº”çš„å€¼
- `args.xxx`: è¿”å› all_matched_args ä¸­ `xxx`é”®å¯¹åº”çš„å€¼
- `options.foo`, `foo`: è¿”å›é€‰é¡¹ `foo` çš„è§£æç»“æœ (OptionResult)
- `options.foo.value`, `foo.value`: è¿”å›é€‰é¡¹ `foo` çš„è§£æå€¼
- `options.foo.args`, `foo.args`: è¿”å›é€‰é¡¹ `foo` çš„è§£æå‚æ•°å­—å…¸
- `options.foo.args.bar`, `foo.bar`: è¿”å›é€‰é¡¹ `foo` çš„å‚æ•°å­—å…¸ä¸­ `bar` é”®å¯¹åº”çš„å€¼
...

åŒæ ·, `Arparma["foo.bar"]` çš„è¡¨ç°ä¸ `query()` ä¸€è‡´

## å…ƒæ•°æ®(Metadata)

`Alconna` çš„å…ƒæ•°æ®ç›¸å½“äºæ‹“å±•çš„å¸®åŠ©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

- `description`: å‘½ä»¤çš„æè¿°
- `usage`: å‘½ä»¤çš„ç”¨æ³•
- `example`: å‘½ä»¤çš„ä½¿ç”¨æ ·ä¾‹
- `author`: å‘½ä»¤çš„ä½œè€…
- `version`: å‘½ä»¤çš„ç‰ˆæœ¬
- `extra`: å‘½ä»¤çš„é¢å¤–ä¿¡æ¯

## å‘½ä»¤é…ç½®(Config)

å‘½ä»¤é…ç½®ç›¸å½“äº v1 ç‰ˆæœ¬çš„ `CommandMeta`ï¼ŒåŒ…æ‹¬ï¼š

- `disable_builtin_options`: ç¦ç”¨çš„å†…ç½®é€‰é¡¹
- `builtin_option_name`: å†…ç½®é€‰é¡¹çš„åç§°
- `enable_message_cache`: æ˜¯å¦å¯ç”¨æ¶ˆæ¯ç¼“å­˜
- `fuzzy_match`: å‘½ä»¤æ˜¯å¦å¼€å¯æ¨¡ç³ŠåŒ¹é…
- `fuzzy_threshold`: æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼
- `raise_exception`: å‘½ä»¤æ˜¯å¦æŠ›å‡ºå¼‚å¸¸
- `hide`: å‘½ä»¤æ˜¯å¦å¯¹ manager éšè—
- `hide_shortcut`: å‘½ä»¤çš„å¿«æ·æŒ‡ä»¤æ˜¯å¦åœ¨ help ä¿¡æ¯ä¸­éšè—
- `keep_crlf`: å‘½ä»¤è§£ææ—¶æ˜¯å¦ä¿ç•™æ¢è¡Œå­—ç¬¦
- `compact`: å‘½ä»¤æ˜¯å¦å…è®¸ç¬¬ä¸€ä¸ªå‚æ•°ç´§éšå¤´éƒ¨
- `strict`: å‘½ä»¤æ˜¯å¦ä¸¥æ ¼åŒ¹é…ï¼Œè‹¥ä¸º False åˆ™æœªçŸ¥å‚æ•°å°†ä½œä¸ºåä¸º $extra çš„å‚æ•°
- `context_style`: å‘½ä»¤ä¸Šä¸‹æ–‡æ’å€¼çš„é£æ ¼ï¼ŒNone ä¸ºå…³é—­ï¼Œbracket ä¸º `{...}`ï¼Œparentheses ä¸º `$(...)`
- `extra`: å‘½ä»¤çš„è‡ªå®šä¹‰é¢å¤–é…ç½®


## ç´§å‡‘å‘½ä»¤

`Alconna`, `Option` å¯ä»¥è®¾ç½® `compact=True` ä½¿å¾—è§£æå‘½ä»¤æ—¶å…è®¸åç§°ä¸åéšå‚æ•°ä¹‹é—´æ²¡æœ‰åˆ†éš”ï¼š

```python
from arclet.alconna import Alconna, Option, Config, Args

alc = Alconna("test", Args.foo(int), Option("BAR", Args.baz(str), compact=True), Config(compact=True))

assert alc.parse("test123 BARabc").matched
```

è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®ç°å¦‚ä¸‹å‘½ä»¤ï¼š

```python
>>> from arclet.alconna import Alconna, Option, Args, append
>>> alc = Alconna("gcc", Option("--flag|-F", Args.content(str), action=append))
>>> alc.parse("gcc -Fabc -Fdef -Fxyz").query("flag.content")
['abc', 'def', 'xyz']
```

å½“ `Option` çš„ `action` ä¸º `count` æ—¶ï¼Œå…¶è‡ªåŠ¨æ”¯æŒ `compact` ç‰¹æ€§ï¼š

```python
>>> from arclet.alconna import Alconna, Option, Args, count
>>> alc = Alconna("pp", Option("--verbose|-v", action=count, default=0))
>>> alc.parse("pp -vvv").query("verbose.value")
3
```

## å¸®åŠ©ä¿¡æ¯

æ¯ä¸ª Alconna å‘½ä»¤ éƒ½å¯ä»¥é€šè¿‡ `--help` æˆ– `-h` è§¦å‘å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç»§æ‰¿
`arclet.alconna.formatter.TextFormatter` æ¥ä¸ªæ€§åŒ–ä¿¡æ¯æ ·å¼ï¼Œå¦‚ï¼š

```python
from arclet.alconna import Alconna, Args, Metadata
from arclet.alconna.tools import MarkdownTextFormatter

alc = Alconna("test", Args.count(int, notice="è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š"), Metadata(description="Hello World"), formatter_type=MarkdownTextFormatter)
alc.parse("test --help")
```

:::details è¾“å‡º:
```
## Hello World

æŒ‡ä»¤:

**test &lt;count:int&gt;**
### æ³¨é‡Š:
&#96;&#96;&#96;
count: è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š
&#96;&#96;&#96;
```
:::

é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯ä»¥é€šè¿‡ `command_manager` è·å–å½“å‰ç¨‹åºä¸‹çš„æ‰€æœ‰å‘½ä»¤ï¼š

```python
from arclet.alconna import command_manager
...
print(command_manager.all_command_help())
```

:::details è¾“å‡º:
```
# å½“å‰å¯ç”¨çš„å‘½ä»¤æœ‰:
 - foo : Unknown
 - bar : Unknown
 - baz : Unknown
 - qux : Unknown
# è¾“å…¥'å‘½ä»¤å --help' æŸ¥çœ‹ç‰¹å®šå‘½ä»¤çš„è¯­æ³•
```
:::

:::tip
Alconna å¯ä»¥è®¾ç½® `config.hide` å‚æ•°ä»¥ä¸è¢« command_manager æ‰“å°å‡ºæ¥ã€‚

```python
from arclet.alconna import Alconna, Config, command_manager
foo = Alconna("foo", Config(hide=True))
...
print(command_manager.all_command_help())
```

:::details è¾“å‡º:
```
# å½“å‰å¯ç”¨çš„å‘½ä»¤æœ‰:
 - bar : Unknown
 - baz : Unknown
 - qux : Unknown
# è¾“å…¥'å‘½ä»¤å --help' æŸ¥çœ‹ç‰¹å®šå‘½ä»¤çš„è¯­æ³•
```
:::

## å‘½åç©ºé—´é…ç½®

å‘½åç©ºé—´é…ç½® ï¼ˆä»¥ä¸‹ç®€ç§°å‘½åç©ºé—´ï¼‰ ç›¸å½“äº `Alconna` çš„é»˜è®¤é…ç½®ï¼Œå…¶ä¼˜å…ˆåº¦ä½äº `Config`ã€‚

`Alconna` é»˜è®¤ä½¿ç”¨ "Alconna" å‘½åç©ºé—´ã€‚

å‘½åç©ºé—´æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š

- name: å‘½åç©ºé—´åç§°
- config: é»˜è®¤é…ç½®
- prefixes: é»˜è®¤å‰ç¼€é…ç½®
- separators: é»˜è®¤åˆ†éš”ç¬¦é…ç½®
- formatter_type: é»˜è®¤æ ¼å¼åŒ–å™¨ç±»å‹
- ...

### æ–°å»ºå‘½åç©ºé—´å¹¶æ›¿æ¢

```python
from arclet.alconna import Alconna, namespace, Namespace, Subcommand, Args, config


ns = Namespace("foo", prefixes=["/"])  # åˆ›å»º "foo"å‘½åç©ºé—´é…ç½®, å®ƒè¦æ±‚åˆ›å»ºçš„Alconnaçš„ä¸»å‘½ä»¤å‰ç¼€å¿…é¡»æ˜¯/

alc = Alconna("pip", Subcommand("install", Args.package(str)), namespace=ns) # åœ¨åˆ›å»ºAlconnaæ—¶å€™ä¼ å…¥å‘½åç©ºé—´ä»¥æ›¿æ¢é»˜è®¤å‘½åç©ºé—´

# å¯ä»¥é€šè¿‡withæ–¹å¼åˆ›å»ºå‘½åç©ºé—´
with namespace("bar") as np1:
    np1.prefixes = ["!"]    # ä»¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼é…ç½®å‘½åç©ºé—´ï¼Œæ­¤æ—¶é…ç½®ä¼šè‡ªåŠ¨æ³¨å…¥ä¸Šä¸‹æ–‡å†…åˆ›å»ºçš„å‘½ä»¤
    np1.formatter_type = ShellTextFormatter  # è®¾ç½®æ­¤å‘½åç©ºé—´ä¸‹çš„å‘½ä»¤çš„ formatter é»˜è®¤ä¸º ShellTextFormatter
    np1.builtin_option_name["help"] = {"å¸®åŠ©", "-h"}  # è®¾ç½®æ­¤å‘½åç©ºé—´ä¸‹çš„å‘½ä»¤çš„å¸®åŠ©é€‰é¡¹åç§°

# ä½ è¿˜å¯ä»¥ä½¿ç”¨configæ¥ç®¡ç†æ‰€æœ‰å‘½åç©ºé—´å¹¶åˆ‡æ¢è‡³ä»»æ„å‘½åç©ºé—´
config.namespaces["foo"] = ns  # å°†å‘½åç©ºé—´æŒ‚è½½åˆ° config ä¸Š

alc = Alconna("pip", Subcommand("install", Args.package(str)), namespace=config.namespaces["foo"]) # ä¹Ÿæ˜¯åŒæ ·å¯ä»¥åˆ‡æ¢åˆ°"foo"å‘½åç©ºé—´
```

### ä¿®æ”¹é»˜è®¤çš„å‘½åç©ºé—´

```python
from arclet.alconna import config, namespace, Namespace


config.default_namespace.prefixes = [...]  # ç›´æ¥ä¿®æ”¹é»˜è®¤é…ç½®

np = Namespace("xxx", prefixes=[...])
config.default_namespace = np  # æ›´æ¢é»˜è®¤çš„å‘½åç©ºé—´

with namespace(config.default_namespace.name) as np:
    np.prefixes = [...]
```


## å¿«æ·æŒ‡ä»¤

å¿«æ·æŒ‡ä»¤é¡¾åæ€ä¹‰ï¼Œå¯ä»¥ä¸ºåŸºç¡€æŒ‡ä»¤åˆ›å»ºä¾¿æ·çš„è§¦å‘æ–¹å¼, å¹¶ä¸”ä¼ é€’å‚æ•°ç»™åŸå‘½ä»¤

ä¸€èˆ¬æƒ…å†µä¸‹ä½ å¯ä»¥é€šè¿‡ `Alconna.shortcut` è¿›è¡Œå¿«æ·æŒ‡ä»¤æ“ä½œ (åˆ›å»ºï¼Œåˆ é™¤)ã€‚

`shortcut` çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¿«æ·æŒ‡ä»¤åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º `ShortcutArgs`ï¼Œä½œä¸ºå¿«æ·æŒ‡ä»¤çš„é…ç½®

```python
class ShortcutArgs(TypedDict):
    """å¿«æ·æŒ‡ä»¤å‚æ•°"""

    command: NotRequired[str]
    """å¿«æ·æŒ‡ä»¤çš„å‘½ä»¤"""
    args: NotRequired[list[Any]]
    """å¿«æ·æŒ‡ä»¤çš„é™„å¸¦å‚æ•°"""
    fuzzy: NotRequired[bool]
    """æ˜¯å¦å…è®¸å‘½ä»¤åéšå‚æ•°"""
    prefix: NotRequired[bool]
    """æ˜¯å¦è°ƒç”¨æ—¶ä¿ç•™æŒ‡ä»¤å‰ç¼€"""
    wrapper: NotRequired[ShortcutRegWrapper]
    """å¿«æ·æŒ‡ä»¤çš„æ­£åˆ™åŒ¹é…ç»“æœçš„é¢å¤–å¤„ç†å‡½æ•°"""
    humanized: NotRequired[str]
    """å¿«æ·æŒ‡ä»¤çš„äººç±»å¯è¯»æè¿°"""
```

å½“ `fuzzy` ä¸º False æ—¶ï¼Œä¼ å…¥ `"æ¶©å›¾1å¼  abc"` ä¹‹ç±»çš„å¿«æ·æŒ‡ä»¤å°†è§†ä¸ºè§£æå¤±è´¥

å¿«æ·æŒ‡ä»¤å…è®¸ä¸‰ç±»ç‰¹æ®Šçš„ placeholder:

- `{%X}`: åªç”¨äº `command`, å¦‚ `setu {%0}`ï¼Œè¡¨ç¤ºæ­¤å¤„å¡«å…¥å¿«æˆªæŒ‡ä»¤åéšçš„ç¬¬ X ä¸ªå‚æ•°ã€‚

  ä¾‹å¦‚ï¼Œè‹¥å¿«æ·æŒ‡ä»¤ä¸º `æ¶©å›¾`, é…ç½®ä¸º `{"command": "setu {%0}"}`, åˆ™æŒ‡ä»¤ `æ¶©å›¾ 1` ç›¸å½“äº `setu 1`
- `{*}`: åªç”¨äº `command`, è¡¨ç¤ºæ­¤å¤„å¡«å…¥æ‰€æœ‰åéšå‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ `{*X}` çš„æ–¹å¼æŒ‡å®šç»„åˆå‚æ•°ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚
- `{X}`: ç”¨äº `command` ä¸ `args`ï¼Œ è¡¨ç¤ºæ­¤å¤„å¡«å…¥å¯èƒ½çš„æ­£åˆ™åŒ¹é…çš„ç»„ï¼š
  - è‹¥ `command` ä¸­å­˜åœ¨åŒ¹é…ç»„ `(xxx)`ï¼Œåˆ™ `{X}` è¡¨ç¤ºç¬¬ X ä¸ªåŒ¹é…ç»„çš„å†…å®¹
  - è‹¥ `command` ä¸­å­˜å‚¨åŒ¹é…ç»„ `(?P<xxx>...)`, åˆ™ `{X}` è¡¨ç¤ºåå­—ä¸º X çš„åŒ¹é…ç»“æœ

é™¤æ­¤ä¹‹å¤–, é€šè¿‡å†…ç½®é€‰é¡¹ `--shortcut` å¯ä»¥åŠ¨æ€æ“ä½œå¿«æ·æŒ‡ä»¤ã€‚

### ç¤ºä¾‹

- `args` çš„ä½¿ç”¨:

```python
from arclet.alconna import Alconna, Args

alc = Alconna("setu", Args.count(int))
alc.shortcut("æ¶©å›¾(\d+)å¼ ", {"args": ["{0}"]})
# 'Alconna::setu çš„å¿«æ·æŒ‡ä»¤: "æ¶©å›¾(\\d+)å¼ " æ·»åŠ æˆåŠŸ'
alc.parse("æ¶©å›¾3å¼ ").query("count")
# 3
```

- `command` çš„ä½¿ç”¨:

```python
from arclet.alconna import Alconna, Args

alc = Alconna("eval", Args.content(str))
alc.shortcut("echo", {"command": "eval print(\\'{*}\\')"})
# 'Alconna::eval çš„å¿«æ·æŒ‡ä»¤: "echo" æ·»åŠ æˆåŠŸ'
alc.shortcut("echo", delete=True) # åˆ é™¤å¿«æ·æŒ‡ä»¤
# 'Alconna::eval çš„å¿«æ·æŒ‡ä»¤: "echo" åˆ é™¤æˆåŠŸ'

@alc.bind() # ç»‘å®šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå™¨, è‹¥åŒ¹é…æˆåŠŸåˆ™ä¼šä¼ å…¥å‚æ•°, è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤æ‰§è¡Œå™¨
def cb(content: str):
    eval(content, {}, {})

alc.parse('eval print(\\"hello world\\")')
# hello world
alc.parse("echo hello world!")
# hello world!
```

## åŠè‡ªåŠ¨è¡¥å…¨

åŠè‡ªåŠ¨è¡¥å…¨ä¸ºç”¨æˆ·æä¾›äº†æ¨èåç»­è¾“å…¥çš„åŠŸèƒ½ã€‚

è¡¥å…¨é»˜è®¤é€šè¿‡ `--comp` æˆ– `-cp` æˆ– `?` è§¦å‘ï¼šï¼ˆå‘½åç©ºé—´é…ç½®å¯ä¿®æ”¹åç§°ï¼‰

```python
from arclet.alconna import Alconna, Args, Option

alc = Alconna("test", Args.abc(int)) + Option("foo") + Option("bar")
alc.parse("test --comp")
```

:::details è¾“å‡º:
```
ä»¥ä¸‹æ˜¯å»ºè®®çš„è¾“å…¥ï¼š
* <abc: int>
* --help
* -h
* -sct
* --shortcut
* foo
* bar
```
:::

### è¡¥å…¨ä¼šè¯

è¡¥å…¨ä¼šè¯åŸºäºåŠè‡ªåŠ¨è¡¥å…¨ï¼Œæä¾›äº†äº¤äº’æ“ä½œè¡¥å…¨çš„æ¥å£

è¡¥å…¨ä¼šè¯é€šè¿‡åˆ›å»º `CompSession` å¹¶è¿›å…¥ä¸Šä¸‹æ–‡è§¦å‘ï¼š

```python
from arclet.alconna import Alconna, Args, Option, CompSession

alc = Alconna("test", Args.abc(int)) + Option("foo") + Option("bar")

with CompSession(alc) as comp:
    alc.parse("test")
if comp.available:
    print("current completion:", comp.current())
    print("next completion:", comp.tab())
    with comp:
        res = comp.enter(["1"])

assert res.matched
```

## ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…

æ¨¡ç³ŠåŒ¹é…é€šè¿‡åœ¨ Alconna ä¸­è®¾ç½®å…¶ `Config.fuzzy_match` å¼€å¯ã€‚

æ¨¡ç³ŠåŒ¹é…ä¼šåº”ç”¨åœ¨ä»»æ„éœ€è¦è¿›è¡Œåç§°åˆ¤æ–­çš„åœ°æ–¹ï¼Œå¦‚**å‘½ä»¤åç§°**ï¼Œ**é€‰é¡¹åç§°**å’Œ**å‚æ•°åç§°**ï¼ˆå¦‚æŒ‡å®šéœ€è¦ä¼ å…¥å‚æ•°åç§°ï¼‰ã€‚

```python
from arclet.alconna import Alconna, Config

alc = Alconna("test_fuzzy", Config(fuzzy_match=True))
alc.parse("test_fuzy")
# output: test_fuzy is not matched. Do you mean "test_fuzzy"?
```

## ä¸Šä¸‹æ–‡æ’å€¼

å½“ `context_style` æ¡ç›®è¢«è®¾ç½®åï¼Œä¼ å…¥çš„å‘½ä»¤ä¸­ç¬¦åˆä¸Šä¸‹æ–‡æ’å€¼çš„å­—æ®µä¼šè¢«è‡ªåŠ¨æ›¿æ¢æˆå½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯ã€‚

ä¸Šä¸‹æ–‡å¯ä»¥åœ¨ `parse` ä¸­ä¼ å…¥ï¼š

```python
from arclet.alconna import Alconna, Args, Config

alc = Alconna("test", Args.foo(int), Config(context_style="parentheses"))

alc.parse("test $(bar)", {"bar": 123})
# {"foo": 123}
```

context_style çš„å€¼åˆ†ä¸¤ç§ï¼š

- `"bracket"`: æ’å€¼æ ¼å¼ä¸º `{...}`ï¼Œä¾‹å¦‚ `{foo}`
- `"parentheses"`: æ’å€¼æ ¼å¼ä¸º `$(...)`ï¼Œä¾‹å¦‚ `$(bar)`

## è‡ªå®šä¹‰è¯­è¨€æ–‡ä»¶

Alconna çš„ i18n æ”¯æŒä½¿ç”¨äº† [`Tarina.lang`](https://github.com/ArcletProject/Tarina/blob/main/src/tarina/lang)

å…¶è¯­è¨€æ–‡ä»¶é…ç½®ä½äº [`arclet.alconna.i18n`](https://github.com/ArcletProject/Alconna/tree/dev/src/arclet/alconna/i18n) ä¸‹

æ‚¨å¯ä»¥é€šè¿‡ `tarina.lang.select` åˆ‡æ¢è¯­è¨€é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `tarina.lang.set` å¯¹å•ä¸€æ–‡æœ¬è¿›è¡Œä¿®æ”¹ã€‚

## å‚è€ƒé“¾æ¥

QQ äº¤æµç¾¤: [ğŸ”—é“¾æ¥](https://jq.qq.com/?_wv=1027&k=PUPOnCSH)

è¦äº†è§£å¦‚ä½•ä½¿ç”¨ Alconna-Graia, å‚è€ƒ [æ¶ˆæ¯é“¾åŒ¹é…/Alconna](https://graiax.cn/guide/message_parser/alconna.html)

è¦äº†è§£å¦‚ä½•ä½¿ç”¨ nonebot-plugin-alconna, å‚è€ƒ [nonebot-plugin-alconna æ–‡æ¡£](https://nonebot.dev/docs/best-practice/alconna/)
