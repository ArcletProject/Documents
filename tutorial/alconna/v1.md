---
next: Alconna 2.0
---


# Alconna

::: warning

è¯¥æ•™ç¨‹æ˜¯å¯¹æ•´ä¸ª Alconna ç‰¹æ€§çš„å¤§è‡´å½’çº³ï¼Œä»¥å¸®åŠ©è¯»è€…ç†Ÿæ‚‰ Alconna çš„ä½¿ç”¨ä¸å¼€å‘ã€‚

æœ‰å…³æ›´å¤šè¯¦ç»†å†…å®¹ï¼Œè¯·å‚é˜… æ–‡æ¡£(/guide/alconna)

:::


[`Alconna`](https://github.com/ArcletProject/Alconna) æ˜¯ `Arclet Project` ä¸‹è´Ÿè´£å‘½ä»¤å‚æ•°è§£æçš„æ¨¡å—ï¼Œæ˜¯ `Arclet` çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ã€‚

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ **Alconna** çš„æ ¸å¿ƒ â€”â€” `Args`, `Subcommand`, `Option`ï¼š

```python
from arclet.alconna import Alconna, Args, Subcommand, Option

alc = Alconna(
    "pip",
    Subcommand(
        "install",
        Args["package", str],
        Option("-r|--requirement", Args["file", str]),
        Option("-i|--index-url", Args["url", str]),
    )
)

res = alc.parse("pip install arclet-entari -i URL")

print(res)
# matched=True, header_match=(origin='pip' result='pip' matched=True groups={}), subcommands={'install': (value=Ellipsis args={'package': 'arclet-entari'} options={'index-url': (value=None args={'url': 'URL'})} subcommands={})}, other_args={'package': 'nonebot2', 'url': 'URL'}

print(res.all_matched_args)
# {'package': 'arclet-entari', 'url': 'URL'}
```

:::details è§£é‡Š
è¿™æ®µä»£ç é€šè¿‡ `Alconna ` åˆ›å»ºäº†ä¸€ä¸ªæ¥å—ä¸»å‘½ä»¤åä¸º `pip`, å­å‘½ä»¤ä¸º `install` ä¸”å­å‘½ä»¤æ¥å—ä¸€ä¸ª **Args** å‚æ•°packageå’ŒäºŒä¸ª **Option** å‚æ•°`requirement`å’Œ`index-url`çš„å‘½ä»¤å‚æ•°è§£æå™¨, é€šè¿‡parseæ–¹æ³•è¿”å›è§£æç»“æœ **Arparma** çš„å®ä¾‹ã€‚
:::

å…¶ç‰¹ç‚¹æœ‰:

* é«˜æ•ˆ
* ç›´è§‚çš„å‘½ä»¤ç»„ä»¶åˆ›å»ºæ–¹å¼ï¼Œä¾‹å¦‚é€‰é¡¹åˆ«åï¼Œé»˜è®¤å€¼ï¼Œè§£ææ“ä½œç­‰
* å¼ºå¤§çš„ç±»å‹è§£æä¸ç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œå…·ä½“åœ¨ `Args` çš„ä½¿ç”¨ä¸Š
* è‡ªå®šä¹‰çš„å¸®åŠ©ä¿¡æ¯æ ¼å¼ï¼Œå¸®åŠ©ä¿¡æ¯ç”±å†…ç½®é€‰é¡¹ `help` è§¦å‘ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªå®šä¹‰çš„ TextFormatter è·å¾—ä¸ä¸€æ ·çš„è¾“å‡ºæ ¼å¼
* å¤šè¯­è¨€æ”¯æŒï¼Œç›®å‰æ”¯æŒä¸­æ–‡ä¸è‹±æ–‡
* æ˜“ç”¨çš„å¿«æ·å‘½ä»¤åˆ›å»ºä¸ä½¿ç”¨ï¼Œå¯ç”±å†…ç½®é€‰é¡¹ `shortcut` è§¦å‘ï¼Œæˆ–ä½¿ç”¨ `Alconna.shortcut()` æ–¹æ³•
* å¯åˆ›å»ºå‘½ä»¤è¡¥å…¨ä¼šè¯, ä»¥å®ç°å¤šè½®è¿ç»­çš„è¡¥å…¨æç¤º
* å¯é€šè¿‡ `Namespace`ï¼Œ`CommandMeta` é…ç½®å‘½ä»¤çš„è¡Œä¸ºä¸å±æ€§ï¼Œä¾‹å¦‚é€šè¿‡ `Namespace` è‡ªå®šä¹‰å†…ç½®é€‰é¡¹çš„è§¦å‘å­—æ®µï¼Œæˆ–é€šè¿‡ `CommandMeta` å¯ç”¨æ¨¡ç³ŠåŒ¹é…
* å¯åµŒå¥—çš„å¤šçº§å­å‘½ä»¤
* `Duplication` èƒ½åƒ `argparse.Namespace` ä¸€æ ·è·å–æŒ‡å®šçš„è§£æç»“æœå¹¶è·å¾—ç±»å‹æ”¯æŒ
* æ­£åˆ™åŒ¹é…æ”¯æŒ
* ...


## å®‰è£…

::: code-group

```bash:no-line-numbers [pdm]
pdm add arclet-alconna
```


```bash:no-line-numbers [poetry]
poetry add arclet-alconna
```

```bash:no-line-numbers [pip]
pip install --upgrade arclet-alconna
```

:::

## å‚æ•°å£°æ˜(Args)

**Args** æ˜¯ç”¨äºå£°æ˜å‘½ä»¤å‚æ•°çš„ç»„ä»¶, åœ¨ Alconna ä¸­æœ‰éå¸¸é‡è¦çš„åœ°ä½ï¼Œç”šè‡³ç§°å¾—ä¸Šæ˜¯æ ¸å¿ƒï¼Œæ¯” Alconna é‡è¦åå€ç”šè‡³ä¹å€ã€‚

**Args** å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ„é€ ï¼š

- `Args[key, var, default][key1, var1, default1][...]`
- `Args[(key, var, default)]`
- `Args.key[var, default]`

å…¶ä¸­ï¼Œkey **ä¸€å®š**æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œ var ä¸€èˆ¬ä¸ºå‚æ•°çš„ç±»å‹ï¼Œdefault ä¸ºå…·ä½“çš„å€¼æˆ–è€… `arclet.alconna.args.Field`ã€‚

å…¶ä¸å‡½æ•°ç­¾åç±»ä¼¼ï¼Œä½†æ˜¯å…è®¸å«æœ‰é»˜è®¤å€¼çš„å‚æ•°åœ¨å‰ï¼›åŒæ—¶æ”¯æŒ keyword-only å‚æ•°ä¸ä¾ç…§æ„é€ é¡ºåºä¼ å…¥ ï¼ˆä½†æ˜¯ä»éœ€è¦åœ¨é keyword-only å‚æ•°ä¹‹åï¼‰ã€‚

### å‚æ•°å(key)

`key` çš„ä½œç”¨æ˜¯ç”¨ä»¥æ ‡è®°è§£æå‡ºæ¥çš„å‚æ•°å¹¶å­˜æ”¾äº **Arparma** ä¸­ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·è°ƒç”¨ã€‚

å…¶æœ‰ä¸‰ç§ä¸º Args æ³¨è§£çš„æ ‡è¯†ç¬¦ï¼Œä¸º `?`ã€`/` ä¸ `!`ã€‚æ ‡è¯†ç¬¦ä¸ name ä¹‹é—´å»ºè®®ä»¥ `;` åˆ†éš”ï¼š

- `!` æ ‡è¯†ç¬¦è¡¨ç¤ºè¯¥å¤„ä¼ å…¥çš„å‚æ•°åº”**ä¸æ˜¯**è§„å®šçš„ç±»å‹ï¼Œæˆ–**ä¸åœ¨**æŒ‡å®šçš„å€¼ä¸­ã€‚
- `?` æ ‡è¯†ç¬¦è¡¨ç¤ºè¯¥å‚æ•°ä¸º**å¯é€‰å‚æ•°**ï¼Œä¼šåœ¨æ— å‚æ•°åŒ¹é…æ—¶**è·³è¿‡**ã€‚
- `/` æ ‡è¯†ç¬¦è¡¨ç¤ºè¯¥å‚æ•°çš„ç±»å‹æ³¨è§£éœ€è¦**éšè—**ã€‚

å¦å¤–ï¼Œå¯¹äºå‚æ•°çš„æ³¨é‡Šä¹Ÿå¯ä»¥æ ‡è®°åœ¨ `key` ä¸­ï¼Œå…¶ä¸ key æˆ–è€…æ ‡è¯†ç¬¦ ä»¥ `#` åˆ†å‰²ï¼š`foo#è¿™æ˜¯æ³¨é‡Š;?` æˆ– `foo?#è¿™æ˜¯æ³¨é‡Š`

:::info

`Args` ä¸­çš„ `key` åœ¨å®é™…å‘½ä»¤ä¸­å¹¶ä¸éœ€è¦ä¼ å…¥ï¼ˆkeyword å‚æ•°é™¤å¤–ï¼‰ï¼š

```python
from arclet.alconna import Alconna, Args

alc = Alconna("test", Args["foo", str])
alc.parse("test --foo abc") # é”™è¯¯
alc.parse("test abc") # æ­£ç¡®
```

è‹¥éœ€è¦ `test --foo abc`ï¼Œä½ åº”è¯¥ä½¿ç”¨ `Option`ï¼š

```python
from arclet.alconna import Alconna, Args, Option

alc = Alconna("test", Option("--foo", Args["foo", str]))
```

:::

### å‚æ•°å€¼(var)

var è´Ÿè´£å‘½ä»¤å‚æ•°çš„**ç±»å‹æ£€æŸ¥ä¸ç±»å‹è½¬åŒ–**

`Args` çš„`var`è¡¨é¢ä¸Šçœ‹éœ€è¦ä¼ å…¥ä¸€ä¸ª `type`ï¼Œä½†å®é™…ä¸Šå®ƒéœ€è¦çš„æ˜¯ä¸€ä¸ª `nepattern.BasePattern` çš„å®ä¾‹ï¼š

```python
from arclet.alconna import Args
from nepattern import BasePattern

# è¡¨ç¤º foo å‚æ•°éœ€è¦åŒ¹é…ä¸€ä¸ª @number æ ·å¼çš„å­—ç¬¦ä¸²
args = Args["foo", BasePattern("@\d+")]
```

`pip` ç¤ºä¾‹ä¸­å¯ä»¥ä¼ å…¥ `str` æ˜¯å› ä¸º `str` å·²ç»æ³¨å†Œåœ¨äº† `nepattern.global_patterns` ä¸­ï¼Œå› æ­¤ä¼šæ›¿æ¢ä¸º `nepattern.global_patterns[str]`

`nepattern.global_patterns`é»˜è®¤æ”¯æŒçš„ç±»å‹æœ‰ï¼š

- `str`: åŒ¹é…ä»»æ„å­—ç¬¦ä¸²
- `int`: åŒ¹é…æ•´æ•°
- `float`: åŒ¹é…æµ®ç‚¹æ•°
- `bool`: åŒ¹é… `True` ä¸ `False` ä»¥åŠä»–ä»¬å°å†™å½¢å¼
- `hex`: åŒ¹é… `0x` å¼€å¤´çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²
- `url`: åŒ¹é…ç½‘å€
- `email`: åŒ¹é… `xxxx@xxx` çš„å­—ç¬¦ä¸²
- `ipv4`: åŒ¹é… `xxx.xxx.xxx.xxx` çš„å­—ç¬¦ä¸²
- `list`: åŒ¹é…ç±»ä¼¼ `["foo","bar","baz"]` çš„å­—ç¬¦ä¸²
- `dict`: åŒ¹é…ç±»ä¼¼ `{"foo":"bar","baz":"qux"}` çš„å­—ç¬¦ä¸²
- `datetime`: ä¼ å…¥ä¸€ä¸ª `datetime` æ”¯æŒçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œæˆ–æ—¶é—´æˆ³
- `Any`: åŒ¹é…ä»»æ„ç±»å‹
- `AnyString`: åŒ¹é…ä»»æ„ç±»å‹ï¼Œè½¬ä¸º `str`
- `Number`: åŒ¹é… `int` ä¸ `float`ï¼Œè½¬ä¸º `int`

åŒæ—¶å¯ä»¥ä½¿ç”¨ typing ä¸­çš„ç±»å‹ï¼š

- `Literal[X]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼
- `Union[X, Y]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªç±»å‹
- `Optional[xxx]`: ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼è®¾ä¸º `None`ï¼Œå¹¶åœ¨è§£æå¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼
- `List[X]`: åŒ¹é…ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­çš„å…ƒç´ ä¸º `X` ç±»å‹
- `Dict[X, Y]`: åŒ¹é…ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­çš„ key ä¸º `X` ç±»å‹ï¼Œvalue ä¸º `Y` ç±»å‹
- ...

:::tip

å‡ ç±»ç‰¹æ®Šçš„ä¼ å…¥æ ‡è®°ï¼š

- `"foo"`: åŒ¹é…å­—ç¬¦ä¸² "foo" (è‹¥æ²¡æœ‰æŸä¸ª `BasePattern` ä¸ä¹‹å…³è”)
- `RawStr("foo")`: åŒ¹é…å­—ç¬¦ä¸² "foo" (å³ä½¿æœ‰ `BasePattern` ä¸ä¹‹å…³è”ä¹Ÿä¸ä¼šè¢«æ›¿æ¢)
- `"foo|bar|baz"`: åŒ¹é… "foo" æˆ– "bar" æˆ– "baz"
- `[foo, bar, Baz, ...]`: åŒ¹é…å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼æˆ–ç±»å‹
- `Callable[[X], Y]`: åŒ¹é…ä¸€ä¸ªå‚æ•°ä¸º `X` ç±»å‹çš„å€¼ï¼Œå¹¶è¿”å›é€šè¿‡è¯¥å‡½æ•°è°ƒç”¨å¾—åˆ°çš„ `Y` ç±»å‹çš„å€¼
- `"re:xxx"`: åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ `xxx`ï¼Œä¼šè¿”å› Match[0]
- `"rep:xxx"`: åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ `xxx`ï¼Œä¼šè¿”å› `re.Match` å¯¹è±¡
- `{foo: bar, baz: qux}`: åŒ¹é…å­—å…¸ä¸­çš„ä»»æ„ä¸€ä¸ªé”®, å¹¶è¿”å›å¯¹åº”çš„å€¼ (ç‰¹æ®Šçš„é”® ... ä¼šåŒ¹é…ä»»æ„çš„å€¼)
- ...

**ç‰¹åˆ«çš„**ï¼Œä½ å¯ä»¥ä¸ä¼ å…¥ `var`ï¼Œæ­¤æ—¶ä¼šä½¿ç”¨ `key` ä½œä¸º `var`, åŒ¹é… `key` å­—ç¬¦ä¸²ã€‚

:::

#### MultiVar ä¸ KeyWordVar

`MultiVar` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ‡æ³¨ï¼Œç”¨äºå‘ŠçŸ¥è§£æå™¨è¯¥å‚æ•°å¯ä»¥æ¥å—å¤šä¸ªå€¼ï¼Œç±»ä¼¼äºå‡½æ•°ä¸­çš„ `*args`ï¼Œå…¶æ„é€ æ–¹æ³•å½¢å¦‚ `MultiVar(str)`ã€‚

åŒæ ·çš„è¿˜æœ‰ `KeyWordVar`ï¼Œç±»ä¼¼äºå‡½æ•°ä¸­çš„ `*, name: type`ï¼Œå…¶æ„é€ æ–¹æ³•å½¢å¦‚ `KeyWordVar(str)`ï¼Œç”¨äºå‘ŠçŸ¥è§£æå™¨è¯¥å‚æ•°ä¸ºä¸€ä¸ª keyword-only å‚æ•°ã€‚

:::info

`MultiVar` ä¸ `KeyWordVar` ç»„åˆæ—¶ï¼Œä»£è¡¨è¯¥å‚æ•°ä¸ºä¸€ä¸ªå¯æ¥å—å¤šä¸ª key-value çš„å‚æ•°ï¼Œç±»ä¼¼äºå‡½æ•°ä¸­çš„ `**kwargs`ï¼Œå…¶æ„é€ æ–¹æ³•å½¢å¦‚ `MultiVar(KeyWordVar(str))`

`MultiVar` ä¸ `KeyWordVar` ä¹Ÿå¯ä»¥ä¼ å…¥ `default` å‚æ•°ï¼Œç”¨äºæŒ‡å®šé»˜è®¤å€¼

`MultiVar` ä¸èƒ½åœ¨ `KeyWordVar` ä¹‹åä¼ å…¥

:::

### å‚æ•°å•å…ƒ(Arg)

**Arg** æ˜¯ **Args** çš„æœ€å°å•ä½ï¼š

```python
Args[Arg(k1, v1), Arg(k2, v2), ...]
```

**Arg** åˆå§‹åŒ–æ—¶å¯ä»¥ä¼ å…¥ï¼š
- name: å‚æ•°å
- value: å‚æ•°ç±»å‹
- field: å‚æ•°åŸŸ
- seps: å‚æ•°åˆ†éš”ç¬¦
- notice: å‚æ•°æ³¨é‡Š
- flags: å‚æ•°æ ‡è¯†ç¬¦

**Arg** å¯ä»¥é€šè¿‡ä¼ å…¥ `seps` æŒ‡å®šè¯¥å‚æ•°å¦‚ä½•ä¸åç»­æ•°æ®åŒºåˆ†ï¼Œä¹Ÿå¯é€šè¿‡ **Args** çš„ `separators` å‚æ•°ç»Ÿä¸€è®¾ç½®

### å‚æ•°åŸŸ(default/Field)

`default` ä¼ å…¥çš„æ˜¯è¯¥å‚æ•°çš„é»˜è®¤å€¼æˆ–è€… `Field`ï¼Œä»¥æºå¸¦å¯¹äºè¯¥å‚æ•°çš„æ›´å¤šä¿¡æ¯ã€‚

é»˜è®¤æƒ…å†µä¸‹ (å³ä¸å£°æ˜) `default` çš„å€¼ä¸ºç‰¹æ®Šå€¼ `Empty`ã€‚è¿™ä¹Ÿæ„å‘³ç€ä½ å¯ä»¥å°†é»˜è®¤å€¼è®¾ç½®ä¸º `None` è¡¨ç¤ºé»˜è®¤å€¼ä¸ºç©ºå€¼ã€‚

`Field` æ„é€ éœ€è¦çš„å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š

- default: å‚æ•°å•å…ƒçš„é»˜è®¤å€¼
- alias: å‚æ•°å•å…ƒé»˜è®¤å€¼çš„åˆ«å
- completion: å‚æ•°å•å…ƒçš„è¡¥å…¨è¯´æ˜ç”Ÿæˆå‡½æ•°
- unmatch_tips: å‚æ•°å•å…ƒçš„é”™è¯¯æç¤ºç”Ÿæˆå‡½æ•°ï¼Œå…¶æ¥æ”¶ä¸€ä¸ªè¡¨ç¤ºåŒ¹é…å¤±è´¥çš„å…ƒç´ çš„å‚æ•°
- missing_tips: å‚æ•°å•å…ƒçš„ç¼ºå¤±æç¤ºç”Ÿæˆå‡½æ•°

## é€‰é¡¹ä¸å­å‘½ä»¤(Option & Subcommand)

**Option** ä¸ **Subcommand** æ˜¯ Alconna ä¸­çš„ä¸¤ä¸ªé‡è¦ç»„ä»¶ã€‚

`Option` å’Œ `Subcommand` å¯ä»¥ä¼ å…¥ä¸€ç»„ `alias`ï¼Œ

å¦‚ `Option("--foo|-F|--FOO|-f")`ï¼Œ`Subcommand("foo", alias=["F"])`

ä¼ å…¥åˆ«ååï¼Œé€‰é¡¹ä¸å­å‘½ä»¤ä¼šé€‰æ‹©å…¶ä¸­é•¿åº¦æœ€é•¿çš„ä½œä¸ºå…¶åç§°ã€‚è‹¥ä¼ å…¥ä¸º "--foo|-f"ï¼Œåˆ™å‘½ä»¤åç§°ä¸º "--foo"

:::tip ç‰¹åˆ«æé†’!!!

Option çš„åå­—æˆ–åˆ«å**æ²¡æœ‰è¦æ±‚**å¿…é¡»åœ¨å‰é¢å†™ä¸Š `-`

Option ä¸ Subcommand çš„å”¯ä¸€åŒºåˆ«åœ¨äº Subcommand å¯ä»¥ä¼ å…¥è‡ªå·±çš„ **Option** ä¸ **Subcommand**

:::


ä»–ä»¬æ‹¥æœ‰å¦‚ä¸‹å…±åŒå‚æ•°ï¼š

- `help_text`: ä¼ å…¥è¯¥ç»„ä»¶çš„å¸®åŠ©ä¿¡æ¯

- `dest`: è¢«æŒ‡å®šä¸ºè§£æå®Œæˆæ—¶æ ‡æ³¨åŒ¹é…ç»“æœçš„æ ‡è¯†ç¬¦ï¼Œä¸ä¼ å…¥æ—¶é»˜è®¤ä¸ºé€‰é¡¹æˆ–å­å‘½ä»¤çš„åç§° (name)

- `requires`: ä¸€æ®µæŒ‡å®šé¡ºåºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä½œä¸ºå”¯ä¸€çš„å‰ç½®åºåˆ—ä¸å‘½ä»¤åµŒå¥—æ›¿æ¢

  å¯¹äºå‘½ä»¤ `test foo bar baz qux <a:int>` æ¥è®²ï¼Œå› ä¸º`foo bar baz` ä»…éœ€è¦åˆ¤æ–­æ˜¯å¦ç›¸ç­‰, æ‰€ä»¥å¯ä»¥è¿™ä¹ˆç¼–å†™ï¼š

  ```python
  Alconna("test", Option("qux", Args.a[int], requires=["foo", "bar", "baz"]))
  ```

- `default`: é»˜è®¤å€¼ï¼Œåœ¨è¯¥ç»„ä»¶æœªè¢«è§£ææ—¶ä½¿ç”¨ä½¿ç”¨è¯¥å€¼æ›¿æ¢ã€‚

  ç‰¹åˆ«çš„ï¼Œä½¿ç”¨ `OptionResult` æˆ– `SubcomanndResult` å¯ä»¥è®¾ç½®åŒ…æ‹¬å‚æ•°å­—å…¸åœ¨å†…çš„é»˜è®¤å€¼ï¼š

  ```python
  from arclet.alconna import Option, OptionResult

  opt1 = Option("--foo", default=False)
  opt2 = Option("--foo", default=OptionResult(value=False, args={"bar": 1}))
  ```

### é€‰é¡¹æ“ä½œ(Action)

`Option` å¯ä»¥ç‰¹åˆ«è®¾ç½®ä¼ å…¥ä¸€ç±» `Action`ï¼Œä½œä¸ºè§£ææ“ä½œ

`Action` åˆ†ä¸ºä¸‰ç±»ï¼š
- `store`: æ—  Args æ—¶ï¼Œ ä»…å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œ é»˜è®¤ä¸º Ellipsisï¼› æœ‰ Args æ—¶ï¼Œ åç»­çš„è§£æç»“æœä¼šè¦†ç›–ä¹‹å‰çš„å€¼
- `append`: æ—  Args æ—¶ï¼Œ å°†å¤šä¸ªå€¼å­˜ä¸ºåˆ—è¡¨ï¼Œ é»˜è®¤ä¸º Ellipsisï¼› æœ‰ Args æ—¶ï¼Œ æ¯ä¸ªè§£æç»“æœä¼šè¿½åŠ åˆ°åˆ—è¡¨ä¸­

  å½“å­˜åœ¨é»˜è®¤å€¼å¹¶ä¸”ä¸ä¸ºåˆ—è¡¨æ—¶ï¼Œ ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼å˜æˆåˆ—è¡¨ï¼Œ ä»¥ä¿è¯è¿½åŠ çš„æ­£ç¡®æ€§
- `count`: æ—  Args æ—¶ï¼Œ è®¡æ•°å™¨åŠ ä¸€ï¼› æœ‰ Args æ—¶ï¼Œ è¡¨ç°ä¸ STORE ç›¸åŒ

  å½“å­˜åœ¨é»˜è®¤å€¼å¹¶ä¸”ä¸ä¸ºæ•°å­—æ—¶ï¼Œ ä¼šè‡ªåŠ¨å°†é»˜è®¤å€¼å˜æˆ 1ï¼Œ ä»¥ä¿è¯è®¡æ•°å™¨çš„æ­£ç¡®æ€§ã€‚

`Alconna` æä¾›äº†é¢„åˆ¶çš„å‡ ç±» `action`ï¼š
- `store`ï¼Œ`store_value`ï¼Œ`store_true`ï¼Œ`store_false`
- `append`ï¼Œ`append_value`
- `count`

## è§£æç»“æœ(Arparma)

`Alconna.parse` ä¼šè¿”å›ç”± **Arparma** æ‰¿è½½çš„è§£æç»“æœã€‚

`Arpamar` ä¼šæœ‰å¦‚ä¸‹å‚æ•°ï¼š

- è°ƒè¯•ç±»
  - matched: æ˜¯å¦åŒ¹é…æˆåŠŸ
  - error_data: è§£æå¤±è´¥æ—¶å‰©ä½™çš„æ•°æ®
  - error_info: è§£æå¤±è´¥æ—¶çš„å¼‚å¸¸å†…å®¹
  - origin: åŸå§‹å‘½ä»¤ï¼Œå¯ä»¥ç±»å‹æ ‡æ³¨

- åˆ†æç±»
  - header_match: å‘½ä»¤å¤´éƒ¨çš„è§£æç»“æœï¼ŒåŒ…æ‹¬åŸå§‹å¤´éƒ¨ã€è§£æåå¤´éƒ¨ã€è§£æç»“æœä¸å¯èƒ½çš„æ­£åˆ™åŒ¹é…ç»„
  - main_args: å‘½ä»¤çš„ä¸»å‚æ•°çš„è§£æç»“æœ
  - options: å‘½ä»¤æ‰€æœ‰é€‰é¡¹çš„è§£æç»“æœ

  - subcommands: å‘½ä»¤æ‰€æœ‰å­å‘½ä»¤çš„è§£æç»“æœ
  - other_args: é™¤ä¸»å‚æ•°å¤–çš„å…¶ä»–è§£æç»“æœ
  - all_matched_args: æ‰€æœ‰ Args çš„è§£æç»“æœ

`Arparma` åŒæ—¶æä¾›äº†ä¾¿æ·çš„æŸ¥è¯¢æ–¹æ³• `query[T]()`ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„ `path` æŸ¥æ‰¾å‚æ•°å¹¶è¿”å›

`path` æ”¯æŒå¦‚ä¸‹ï¼š
- `main_args`, `options`, ...: è¿”å›å¯¹åº”çš„å±æ€§
- `args`: è¿”å› all_matched_args
- `main_args.xxx`, `options.xxx`, ...: è¿”å›å­—å…¸ä¸­ `xxx`é”®å¯¹åº”çš„å€¼
- `args.xxx`: è¿”å› all_matched_args ä¸­ `xxx`é”®å¯¹åº”çš„å€¼
- `options.foo`, `foo`: è¿”å›é€‰é¡¹ `foo` çš„è§£æç»“æœ (OptionResult)
- `options.foo.value`, `foo.value`: è¿”å›é€‰é¡¹ `foo` çš„è§£æå€¼
- `options.foo.args`, `foo.args`: è¿”å›é€‰é¡¹ `foo` çš„è§£æå‚æ•°å­—å…¸
- `options.foo.args.bar`, `foo.bar`: è¿”å›é€‰é¡¹ `foo` çš„å‚æ•°å­—å…¸ä¸­ `bar` é”®å¯¹åº”çš„å€¼
...

åŒæ ·, `Arparma["foo.bar"]` çš„è¡¨ç°ä¸ `query()` ä¸€è‡´

## å…ƒæ•°æ®(CommandMeta)

`Alconna` çš„å…ƒæ•°æ®ç›¸å½“äºå…¶é…ç½®ï¼Œæ‹¥æœ‰ä»¥ä¸‹æ¡ç›®ï¼š

- `description`: å‘½ä»¤çš„æè¿°
- `usage`: å‘½ä»¤çš„ç”¨æ³•
- `example`: å‘½ä»¤çš„ä½¿ç”¨æ ·ä¾‹
- `author`: å‘½ä»¤çš„ä½œè€…
- `fuzzy_match`: å‘½ä»¤æ˜¯å¦å¼€å¯æ¨¡ç³ŠåŒ¹é…
- `fuzzy_threshold`: æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼
- `raise_exception`: å‘½ä»¤æ˜¯å¦æŠ›å‡ºå¼‚å¸¸
- `hide`: å‘½ä»¤æ˜¯å¦å¯¹ manager éšè—
- `hide_shortcut`: å‘½ä»¤çš„å¿«æ·æŒ‡ä»¤æ˜¯å¦åœ¨ help ä¿¡æ¯ä¸­éšè—
- `keep_crlf`: å‘½ä»¤è§£ææ—¶æ˜¯å¦ä¿ç•™æ¢è¡Œå­—ç¬¦
- `compact`: å‘½ä»¤æ˜¯å¦å…è®¸ç¬¬ä¸€ä¸ªå‚æ•°ç´§éšå¤´éƒ¨
- `strict`: å‘½ä»¤æ˜¯å¦ä¸¥æ ¼åŒ¹é…ï¼Œè‹¥ä¸º False åˆ™æœªçŸ¥å‚æ•°å°†ä½œä¸ºåä¸º $extra çš„å‚æ•°
- `context_style`: å‘½ä»¤ä¸Šä¸‹æ–‡æ’å€¼çš„é£æ ¼ï¼ŒNone ä¸ºå…³é—­ï¼Œbracket ä¸º `{...}`ï¼Œparentheses ä¸º `$(...)`
- `extra`: å‘½ä»¤çš„è‡ªå®šä¹‰é¢å¤–ä¿¡æ¯

å…ƒæ•°æ®ä¸€å®šä½¿ç”¨ `meta=...` å½¢å¼ä¼ å…¥ï¼š

```python
from arclet.alconna import Alconna, CommandMeta

alc = Alconna(..., meta=CommandMeta("foo", example="bar"))
```

## ç´§å‡‘å‘½ä»¤

`Alconna`, `Option` å¯ä»¥è®¾ç½® `compact=True` ä½¿å¾—è§£æå‘½ä»¤æ—¶å…è®¸åç§°ä¸åéšå‚æ•°ä¹‹é—´æ²¡æœ‰åˆ†éš”ï¼š

```python
from arclet.alconna import Alconna, Option, CommandMeta, Args

alc = Alconna("test", Args["foo", int], Option("BAR", Args["baz", str], compact=True), meta=CommandMeta(compact=True))

assert alc.parse("test123 BARabc").matched
```

è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®ç°å¦‚ä¸‹å‘½ä»¤ï¼š

```python
>>> from arclet.alconna import Alconna, Option, Args, append
>>> alc = Alconna("gcc", Option("--flag|-F", Args["content", str], action=append))
>>> alc.parse("gcc -Fabc -Fdef -Fxyz").query("flag.content")
['abc', 'def', 'xyz']
```

å½“ `Option` çš„ `action` ä¸º `count` æ—¶ï¼Œå…¶è‡ªåŠ¨æ”¯æŒ `compact` ç‰¹æ€§ï¼š

```python
>>> from arclet.alconna import Alconna, Option, Args, count
>>> alc = Alconna("pp", Option("--verbose|-v", action=count, default=0))
>>> alc.parse("pp -vvv").query("verbose.value")
3
```

## å¸®åŠ©ä¿¡æ¯

æ¯ä¸ª Alconna å‘½ä»¤ éƒ½å¯ä»¥é€šè¿‡ `--help` æˆ– `-h` è§¦å‘å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç»§æ‰¿
`arclet.alconna.formatter.TextFormatter` æ¥ä¸ªæ€§åŒ–ä¿¡æ¯æ ·å¼ï¼Œå¦‚ï¼š

```python
from arclet.alconna import Alconna, Args, CommandMeta
from arclet.alconna.tools import MarkdownTextFormatter

alc = Alconna("test", Args["count#è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š", int], formatter_type=MarkdownTextFormatter, meta=CommandMeta(description="Hello World"))
alc.parse("test --help")
```

:::details è¾“å‡º:
```txt
## Hello World

æŒ‡ä»¤:

**test &lt;count:int&gt;**
### æ³¨é‡Š:
&#96;&#96;&#96;
count: è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š
&#96;&#96;&#96;
```
:::

é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯ä»¥é€šè¿‡ `command_manager` è·å–å½“å‰ç¨‹åºä¸‹çš„æ‰€æœ‰å‘½ä»¤ï¼š

```python
from arclet.alconna import command_manager
...
print(command_manager.all_command_help())
```

:::details è¾“å‡º:
```txt
# å½“å‰å¯ç”¨çš„å‘½ä»¤æœ‰:
 - foo : Unknown
 - bar : Unknown
 - baz : Unknown
 - qux : Unknown
# è¾“å…¥'å‘½ä»¤å --help' æŸ¥çœ‹ç‰¹å®šå‘½ä»¤çš„è¯­æ³•
```
:::

:::tip
Alconna å¯ä»¥è®¾ç½® `meta.hide` å‚æ•°ä»¥ä¸è¢« command_manager æ‰“å°å‡ºæ¥ã€‚

```python
from arclet.alconna import Alconna, CommandMeta, command_manager
foo = Alconna("foo", meta=CommandMeta(hide=True))
...
print(command_manager.all_command_help())
```

:::details è¾“å‡º:
```txt
# å½“å‰å¯ç”¨çš„å‘½ä»¤æœ‰:
 - bar : Unknown
 - baz : Unknown
 - qux : Unknown
# è¾“å…¥'å‘½ä»¤å --help' æŸ¥çœ‹ç‰¹å®šå‘½ä»¤çš„è¯­æ³•
```
:::

## å‘½åç©ºé—´é…ç½®

å‘½åç©ºé—´é…ç½® ï¼ˆä»¥ä¸‹ç®€ç§°å‘½åç©ºé—´ï¼‰ ç›¸å½“äº `Alconna` çš„é»˜è®¤é…ç½®ï¼Œå…¶ä¼˜å…ˆåº¦ä½äº `CommandMeta`ã€‚

`Alconna` é»˜è®¤ä½¿ç”¨ "Alconna" å‘½åç©ºé—´ã€‚

å‘½åç©ºé—´æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š

- name: å‘½åç©ºé—´åç§°
- prefixes: é»˜è®¤å‰ç¼€é…ç½®
- separators: é»˜è®¤åˆ†éš”ç¬¦é…ç½®
- formatter_type: é»˜è®¤æ ¼å¼åŒ–å™¨ç±»å‹
- fuzzy_match: é»˜è®¤æ˜¯å¦å¼€å¯æ¨¡ç³ŠåŒ¹é…
- raise_exception: é»˜è®¤æ˜¯å¦æŠ›å‡ºå¼‚å¸¸
- builtin_option_name: é»˜è®¤çš„å†…ç½®é€‰é¡¹åç§°(--help, --shortcut, --comp)
- disable_builtin_options: é»˜è®¤ç¦ç”¨çš„å†…ç½®é€‰é¡¹(--help, --shortcut, --comp)
- enable_message_cache: é»˜è®¤æ˜¯å¦å¯ç”¨æ¶ˆæ¯ç¼“å­˜
- compact: é»˜è®¤æ˜¯å¦å¼€å¯ç´§å‡‘æ¨¡å¼
- strict: å‘½ä»¤æ˜¯å¦ä¸¥æ ¼åŒ¹é…
- context_style: å‘½ä»¤ä¸Šä¸‹æ–‡æ’å€¼çš„é£æ ¼
- ...

### æ–°å»ºå‘½åç©ºé—´å¹¶æ›¿æ¢

```python
from arclet.alconna import Alconna, namespace, Namespace, Subcommand, Args, config


ns = Namespace("foo", prefixes=["/"])  # åˆ›å»º "foo"å‘½åç©ºé—´é…ç½®, å®ƒè¦æ±‚åˆ›å»ºçš„Alconnaçš„ä¸»å‘½ä»¤å‰ç¼€å¿…é¡»æ˜¯/

alc = Alconna("pip", Subcommand("install", Args["package", str]), namespace=ns) # åœ¨åˆ›å»ºAlconnaæ—¶å€™ä¼ å…¥å‘½åç©ºé—´ä»¥æ›¿æ¢é»˜è®¤å‘½åç©ºé—´

# å¯ä»¥é€šè¿‡withæ–¹å¼åˆ›å»ºå‘½åç©ºé—´
with namespace("bar") as np1:
    np1.prefixes = ["!"]    # ä»¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼é…ç½®å‘½åç©ºé—´ï¼Œæ­¤æ—¶é…ç½®ä¼šè‡ªåŠ¨æ³¨å…¥ä¸Šä¸‹æ–‡å†…åˆ›å»ºçš„å‘½ä»¤
    np1.formatter_type = ShellTextFormatter  # è®¾ç½®æ­¤å‘½åç©ºé—´ä¸‹çš„å‘½ä»¤çš„ formatter é»˜è®¤ä¸º ShellTextFormatter
    np1.builtin_option_name["help"] = {"å¸®åŠ©", "-h"}  # è®¾ç½®æ­¤å‘½åç©ºé—´ä¸‹çš„å‘½ä»¤çš„å¸®åŠ©é€‰é¡¹åç§°

# ä½ è¿˜å¯ä»¥ä½¿ç”¨configæ¥ç®¡ç†æ‰€æœ‰å‘½åç©ºé—´å¹¶åˆ‡æ¢è‡³ä»»æ„å‘½åç©ºé—´
config.namespaces["foo"] = ns  # å°†å‘½åç©ºé—´æŒ‚è½½åˆ° config ä¸Š

alc = Alconna("pip", Subcommand("install", Args["package", str]), namespace=config.namespaces["foo"]) # ä¹Ÿæ˜¯åŒæ ·å¯ä»¥åˆ‡æ¢åˆ°"foo"å‘½åç©ºé—´
```

### ä¿®æ”¹é»˜è®¤çš„å‘½åç©ºé—´

```python
from arclet.alconna import config, namespace, Namespace


config.default_namespace.prefixes = [...]  # ç›´æ¥ä¿®æ”¹é»˜è®¤é…ç½®

np = Namespace("xxx", prefixes=[...])
config.default_namespace = np  # æ›´æ¢é»˜è®¤çš„å‘½åç©ºé—´

with namespace(config.default_namespace.name) as np:
    np.prefixes = [...]
```


## å¿«æ·æŒ‡ä»¤

å¿«æ·æŒ‡ä»¤é¡¾åæ€ä¹‰ï¼Œå¯ä»¥ä¸ºåŸºç¡€æŒ‡ä»¤åˆ›å»ºä¾¿æ·çš„è§¦å‘æ–¹å¼, å¹¶ä¸”ä¼ é€’å‚æ•°ç»™åŸå‘½ä»¤

ä¸€èˆ¬æƒ…å†µä¸‹ä½ å¯ä»¥é€šè¿‡ `Alconna.shortcut` è¿›è¡Œå¿«æ·æŒ‡ä»¤æ“ä½œ (åˆ›å»ºï¼Œåˆ é™¤).

`shortcut` çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¿«æ·æŒ‡ä»¤åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º `ShortcutArgs`ï¼Œä½œä¸ºå¿«æ·æŒ‡ä»¤çš„é…ç½®

```python
class ShortcutArgs(TypedDict):
    """å¿«æ·æŒ‡ä»¤å‚æ•°"""

    command: NotRequired[str]
    """å¿«æ·æŒ‡ä»¤çš„å‘½ä»¤"""
    args: NotRequired[list[Any]]
    """å¿«æ·æŒ‡ä»¤çš„é™„å¸¦å‚æ•°"""
    fuzzy: NotRequired[bool]
    """æ˜¯å¦å…è®¸å‘½ä»¤åéšå‚æ•°"""
    prefix: NotRequired[bool]
    """æ˜¯å¦è°ƒç”¨æ—¶ä¿ç•™æŒ‡ä»¤å‰ç¼€"""
    wrapper: NotRequired[ShortcutRegWrapper]
    """å¿«æ·æŒ‡ä»¤çš„æ­£åˆ™åŒ¹é…ç»“æœçš„é¢å¤–å¤„ç†å‡½æ•°"""
    humanized: NotRequired[str]
    """å¿«æ·æŒ‡ä»¤çš„äººç±»å¯è¯»æè¿°"""
```

å½“ `fuzzy` ä¸º False æ—¶ï¼Œä¼ å…¥ `"æ¶©å›¾1å¼  abc"` ä¹‹ç±»çš„å¿«æ·æŒ‡ä»¤å°†è§†ä¸ºè§£æå¤±è´¥

å¿«æ·æŒ‡ä»¤å…è®¸ä¸‰ç±»ç‰¹æ®Šçš„ placeholder:

- `{%X}`: åªç”¨äº `command`, å¦‚ `setu {%0}`ï¼Œè¡¨ç¤ºæ­¤å¤„å¡«å…¥å¿«æˆªæŒ‡ä»¤åéšçš„ç¬¬ X ä¸ªå‚æ•°ã€‚

  ä¾‹å¦‚ï¼Œè‹¥å¿«æ·æŒ‡ä»¤ä¸º `æ¶©å›¾`, é…ç½®ä¸º `{"command": "setu {%0}"}`, åˆ™æŒ‡ä»¤ `æ¶©å›¾ 1` ç›¸å½“äº `setu 1`
- `{*}`: åªç”¨äº `command`, è¡¨ç¤ºæ­¤å¤„å¡«å…¥æ‰€æœ‰åéšå‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ `{*X}` çš„æ–¹å¼æŒ‡å®šç»„åˆå‚æ•°ä¹‹é—´çš„åˆ†éš”ç¬¦ã€‚
- `{X}`: ç”¨äº `command` ä¸ `args`ï¼Œ è¡¨ç¤ºæ­¤å¤„å¡«å…¥å¯èƒ½çš„æ­£åˆ™åŒ¹é…çš„ç»„ï¼š
  - è‹¥ `command` ä¸­å­˜åœ¨åŒ¹é…ç»„ `(xxx)`ï¼Œåˆ™ `{X}` è¡¨ç¤ºç¬¬ X ä¸ªåŒ¹é…ç»„çš„å†…å®¹
  - è‹¥ `command` ä¸­å­˜å‚¨åŒ¹é…ç»„ `(?P<xxx>...)`, åˆ™ `{X}` è¡¨ç¤ºåå­—ä¸º X çš„åŒ¹é…ç»“æœ

é™¤æ­¤ä¹‹å¤–, é€šè¿‡å†…ç½®é€‰é¡¹ `--shortcut` å¯ä»¥åŠ¨æ€æ“ä½œå¿«æ·æŒ‡ä»¤ã€‚

### ç¤ºä¾‹

- `args` çš„ä½¿ç”¨:

```python
from arclet.alconna import Alconna, Args

alc = Alconna("setu", Args["count", int])
alc.shortcut("æ¶©å›¾(\d+)å¼ ", {"args": ["{0}"]})
# 'Alconna::setu çš„å¿«æ·æŒ‡ä»¤: "æ¶©å›¾(\\d+)å¼ " æ·»åŠ æˆåŠŸ'
alc.parse("æ¶©å›¾3å¼ ").query("count")
# 3
```

- `command` çš„ä½¿ç”¨:

```python
from arclet.alconna import Alconna, Args

alc = Alconna("eval", Args["content", str])
alc.shortcut("echo", {"command": "eval print(\\'{*}\\')"})
# 'Alconna::eval çš„å¿«æ·æŒ‡ä»¤: "echo" æ·»åŠ æˆåŠŸ'
alc.shortcut("echo", delete=True) # åˆ é™¤å¿«æ·æŒ‡ä»¤
# 'Alconna::eval çš„å¿«æ·æŒ‡ä»¤: "echo" åˆ é™¤æˆåŠŸ'

@alc.bind() # ç»‘å®šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå™¨, è‹¥åŒ¹é…æˆåŠŸåˆ™ä¼šä¼ å…¥å‚æ•°, è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤æ‰§è¡Œå™¨
def cb(content: str):
    eval(content, {}, {})

alc.parse('eval print(\\"hello world\\")')
# hello world
alc.parse("echo hello world!")
# hello world!
```

## åŠè‡ªåŠ¨è¡¥å…¨

åŠè‡ªåŠ¨è¡¥å…¨ä¸ºç”¨æˆ·æä¾›äº†æ¨èåç»­è¾“å…¥çš„åŠŸèƒ½ã€‚

è¡¥å…¨é»˜è®¤é€šè¿‡ `--comp` æˆ– `-cp` æˆ– `?` è§¦å‘ï¼šï¼ˆå‘½åç©ºé—´é…ç½®å¯ä¿®æ”¹åç§°ï¼‰

```python
from arclet.alconna import Alconna, Args, Option

alc = Alconna("test", Args["abc", int]) + Option("foo") + Option("bar")
alc.parse("test --comp")
```

:::details è¾“å‡º
```txt
ä»¥ä¸‹æ˜¯å»ºè®®çš„è¾“å…¥ï¼š
* <abc: int>
* --help
* -h
* -sct
* --shortcut
* foo
* bar
```
:::

### è¡¥å…¨ä¼šè¯

è¡¥å…¨ä¼šè¯åŸºäºåŠè‡ªåŠ¨è¡¥å…¨ï¼Œæä¾›äº†äº¤äº’æ“ä½œè¡¥å…¨çš„æ¥å£

è¡¥å…¨ä¼šè¯é€šè¿‡åˆ›å»º `CompSession` å¹¶è¿›å…¥ä¸Šä¸‹æ–‡è§¦å‘ï¼š

```python
from arclet.alconna import Alconna, Args, Option, CompSession

alc = Alconna("test", Args["abc", int]) + Option("foo") + Option("bar")

with CompSession(alc) as comp:
    alc.parse("test")
if comp.available:
    print("current completion:", comp.current())
    print("next completion:", comp.tab())
    with comp:
        res = comp.enter(["1"])

assert res.matched
```

## Duplication

**Duplication** ç”¨æ¥æä¾›æ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨ï¼Œç±»ä¼¼äº **ArgParse** çš„ **Namespace**ï¼Œç»æµ‹è¯•è¡¨ç°è‰¯å¥½ï¼ˆå¥½è€¶ï¼‰ã€‚

æ™®é€šæƒ…å†µä¸‹ä½¿ç”¨ï¼Œéœ€è¦åˆ©ç”¨åˆ° **ArgsStub**ã€**OptionStub** å’Œ **SubcommandStub** ä¸‰ä¸ªéƒ¨åˆ†ï¼Œ

ä»¥pipä¸ºä¾‹ï¼Œå…¶å¯¹åº”çš„ Duplication åº”å¦‚ä¸‹æ„é€ ï¼š

```python
from arclet.alconna import OptionResult, Duplication, SubcommandStub

class MyDup(Duplication):
    verbose: OptionResult
    install: SubcommandStub  # é€‰é¡¹ä¸å­å‘½ä»¤å¯¹åº”çš„stubçš„å˜é‡åå¿…é¡»ä¸å…¶åå­—ç›¸åŒ
```

å¹¶åœ¨è§£ææ—¶ä¼ å…¥ Duplicationï¼š

```python
result = alc.parse("pip -v install ...", duplication=MyDup)
>>> type(result)
<class MyDup>
```

**Duplication** ä¹Ÿå¯ä»¥å¦‚ **Namespace** ä¸€æ ·ç›´æ¥æ ‡æ˜å‚æ•°åç§°å’Œç±»å‹ï¼š

```python
from typing import Optional
from arclet.alconna import Duplication


class MyDup(Duplication):
    package: str
    file: Optional[str] = None
    url: Optional[str] = None
```

## ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…

æ¨¡ç³ŠåŒ¹é…é€šè¿‡åœ¨ Alconna ä¸­è®¾ç½®å…¶ CommandMeta å¼€å¯ã€‚

æ¨¡ç³ŠåŒ¹é…ä¼šåº”ç”¨åœ¨ä»»æ„éœ€è¦è¿›è¡Œåç§°åˆ¤æ–­çš„åœ°æ–¹ï¼Œå¦‚**å‘½ä»¤åç§°**ï¼Œ**é€‰é¡¹åç§°**å’Œ**å‚æ•°åç§°**ï¼ˆå¦‚æŒ‡å®šéœ€è¦ä¼ å…¥å‚æ•°åç§°ï¼‰ã€‚

```python
from arclet.alconna import Alconna, CommandMeta

alc = Alconna("test_fuzzy", meta=CommandMeta(fuzzy_match=True))
alc.parse("test_fuzy")
# output: test_fuzy is not matched. Do you mean "test_fuzzy"?
```

## ä¸Šä¸‹æ–‡æ’å€¼

å½“ `context_style` æ¡ç›®è¢«è®¾ç½®åï¼Œä¼ å…¥çš„å‘½ä»¤ä¸­ç¬¦åˆä¸Šä¸‹æ–‡æ’å€¼çš„å­—æ®µä¼šè¢«è‡ªåŠ¨æ›¿æ¢æˆå½“å‰ä¸Šä¸‹æ–‡ä¸­çš„ä¿¡æ¯ã€‚

ä¸Šä¸‹æ–‡å¯ä»¥åœ¨ `parse` ä¸­ä¼ å…¥ï¼š

```python
from arclet.alconna import Alconna, Args, CommandMeta

alc = Alconna("test", Args["foo", int], meta=CommandMeta(context_style="parentheses"))

alc.parse("test $(bar)", {"bar": 123})
# {"foo": 123}
```

context_style çš„å€¼åˆ†ä¸¤ç§ï¼š

- `"bracket"`: æ’å€¼æ ¼å¼ä¸º `{...}`ï¼Œä¾‹å¦‚ `{foo}`
- `"parentheses"`: æ’å€¼æ ¼å¼ä¸º `$(...)`ï¼Œä¾‹å¦‚ `$(bar)`

## è‡ªå®šä¹‰è¯­è¨€æ–‡ä»¶

Alconna çš„ i18n æ”¯æŒä½¿ç”¨äº† [`Tarina.lang`](https://github.com/ArcletProject/Tarina/blob/main/src/tarina/lang)

å…¶è¯­è¨€æ–‡ä»¶é…ç½®ä½äº [`arclet.alconna.i18n`](https://github.com/ArcletProject/Alconna/tree/dev/src/arclet/alconna/i18n) ä¸‹

æ‚¨å¯ä»¥é€šè¿‡ `tarina.lang.select` åˆ‡æ¢è¯­è¨€é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `tarina.lang.set` å¯¹å•ä¸€æ–‡æœ¬è¿›è¡Œä¿®æ”¹ã€‚

## å‚è€ƒé“¾æ¥

QQ äº¤æµç¾¤: [ğŸ”—é“¾æ¥](https://jq.qq.com/?_wv=1027&k=PUPOnCSH)

è¦äº†è§£å¦‚ä½•ä½¿ç”¨ Alconna-Graia, å‚è€ƒ [æ¶ˆæ¯é“¾åŒ¹é…/Alconna](https://graiax.cn/guide/message_parser/alconna.html)

è¦äº†è§£å¦‚ä½•ä½¿ç”¨ nonebot-plugin-alconna, å‚è€ƒ [nonebot-plugin-alconna æ–‡æ¡£](https://nonebot.dev/docs/best-practice/alconna/)
